<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web Design and Development</title>
  <script>
    // Hàm validate
    function formValid() {
      var f = document.frmRegister;

      var phone_pattern = /^((\(0\d{1,3}\)\d{7})|(0\d{9,10}))$/;
      var email_pattern = /^[a-zA-Z][\w.-]*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

      if (f.username.value.trim() === "") {
        alert("Username can't be empty");
        f.username.focus();
        return false;
      }

      if (f.password.value.length < 6 || f.password.value.length > 20) {
        alert("Password length must be from 6 to 20 characters");
        f.password.focus();
        return false;
      }

      if (f.confirm_password.value !== f.password.value) {
        alert("Password doesn't match");
        f.confirm_password.focus();
        return false;
      }

      // Kiểm tra giới tính (nếu muốn bắt buộc)
      if (f.gender && f.gender.length) {
        if (!f.gender[0].checked && !f.gender[1].checked) {
          alert("You must select your gender");
          f.gender[0].focus();
          return false;
        }
      }

      if (!phone_pattern.test(f.phone.value)) {
        alert("Invalid phone number");
        f.phone.focus();
        return false;
      }

      if (!email_pattern.test(f.email.value)) {
        alert("Invalid email address");
        f.email.focus();
        return false;
      }

      // Kiểm tra sở thích
      var favs = document.getElementsByName("favourite");
      var favChecked = false;
      for (var i = 0; i < favs.length; i++) {
        if (favs[i].checked) {
          favChecked = true;
          break;
        }
      }
      if (!favChecked) {
        alert("You must select at least one favourite");
        favs[0].focus();
        return false;
      }

      if (f.picture.value === "") {
        alert("You must select your picture");
        f.picture.focus();
        return false;
      }

      if (f.description.value.trim() === "") {
        alert("You must enter description");
        f.description.focus();
        return false;
      }

      alert("All register information are correct.");
      return true;
    }

    // Ngăn Enter submit sớm và chuyển focus sang trường tiếp theo
    document.addEventListener('DOMContentLoaded', function () {
      // Lấy danh sách các phần tử focusable trong form (trừ submit/reset và textarea)
      var form = document.forms['frmRegister'];
      var els = Array.prototype.slice.call(form.querySelectorAll('input, select, textarea'));
      // Lọc: bỏ submit/reset, và giữ textarea để không can thiệp (Enter trong textarea = newline)
      var focusable = els.filter(function(el) {
        var t = el.type ? el.type.toLowerCase() : '';
        if (el.tagName.toLowerCase() === 'textarea') return false;
        if (t === 'submit' || t === 'reset' || t === 'button') return false;
        // include file, text, password, radio, checkbox, select
        return true;
      });

      // Gán sự kiện keydown cho từng phần tử focusable
      focusable.forEach(function(el, idx) {
        el.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            // Với radio/checkbox, mặc định Enter có thể chọn -> để việc đó xảy ra nếu cần
            var tag = el.tagName.toLowerCase();
            var type = el.type ? el.type.toLowerCase() : '';
            // Nếu là radio/checkbox, ta không can thiệp khi Enter (để có thể toggle)
            if (type === 'radio' || type === 'checkbox') {
              return;
            }
            e.preventDefault();
            // chuyển focus tới phần tử tiếp theo (nếu có)
            var next = focusable[idx + 1];
            if (next) {
              next.focus();
              // nếu next là input text — chọn toàn bộ text (tuỳ thích)
              if (next.select) try { next.select(); } catch(err) {}
            } else {
              // Nếu không còn phần tử nào nữa thì submit form
              // Gọi submit trực tiếp để bypass event key (và trigger onsubmit)
              form.requestSubmit ? form.requestSubmit() : form.submit();
            }
          }
        });
      });
    });
  </script>
</head>
<body>
  <h3 style="text-align:right;">Web Design and Development</h3>

  <form name="frmRegister" method="get" enctype="multipart/form-data" onsubmit="return formValid();">
    <table border="0" align="center" cellpadding="5" cellspacing="0" style="width:500px;">
      <tr>
        <th colspan="2" style="background-color:#006699; color:white; font-size:18px;">REGISTER NEW ACCOUNT</th>
      </tr>

      <tr>
        <td><i>Username</i></td>
        <td><input type="text" name="username" autocomplete="off"></td>
      </tr>

      <tr>
        <td><i>Password</i></td>
        <td><input type="password" name="password"></td>
      </tr>

      <tr>
        <td><i>Confirm password</i></td>
        <td><input type="password" name="confirm_password"></td>
      </tr>

      <tr>
        <td><i>Gender</i></td>
        <td>   
          <input type="radio" name="gender" value="male"> Male
          <input type="radio" name="gender" value="female"> Female
        </td>
      </tr>

      <tr>
        <td><i>Phone</i></td>
        <td><input type="text" name="phone"></td>
      </tr>

      <tr>
        <td><i>Email</i></td>
        <td><input type="text" name="email"></td>
      </tr>

      <tr>
        <td><i>Favourite</i></td>
        <td>
          <input type="checkbox" name="favourite" value="music"> Music
          <input type="checkbox" name="favourite" value="reading"> Reading
        </td>
      </tr>

      <tr>
        <td><i>Picture</i></td>
        <td><input type="file" name="picture"></td>
      </tr>

      <tr>
        <td><i>Description</i></td>
        <td><textarea name="description" rows="5" cols="40"></textarea></td>
      </tr>

      <tr>
        <td><i>Education level</i></td>
        <td>
          <select name="education">
            <option>Aptech</option>
            <option>University</option>
            <option>College</option>
            <option>High school</option>
          </select>
        </td>
      </tr>

      <tr>
        <td><i>Language</i></td>
        <td>
          <select name="language" size="4" multiple>
            <option>Vietnamese</option>
            <option>English</option>
            <option>French</option>
            <option>Japanese</option>
          </select>
        </td>
      </tr>

      <tr>
        <td colspan="2" align="center">
          <input type="submit" value="Register">
          <input type="reset" value="Reset">
        </td>
      </tr>
    </table>
  </form>
</body>
</html>
